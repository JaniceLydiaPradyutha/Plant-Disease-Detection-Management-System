<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farmer Portal | Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(to bottom, #F5F5F5, #E8F5E9);
            color: #2E2E2E;
            min-height: 100vh;
            line-height: 1.6;
            display: flex;
        }

        /* Sidebar Navigation */
        .sidebar {
            width: 250px;
            background-color: #4CAF50;
            color: white;
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            padding: 20px 0;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            z-index: 1000;
            overflow-y: auto;
        }

        .logo {
            text-align: center;
            padding: 20px 0;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            margin-bottom: 20px;
        }

        .logo h1 {
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            font-size: 1.5rem;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            padding: 15px 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .nav-item:hover, .nav-item.active {
            background-color: rgba(255,255,255,0.1);
        }

        .nav-item i {
            font-size: 1.2rem;
            width: 25px;
        }

        /* Main Content */
        .main-content {
            margin-left: 250px;
            padding: 30px;
            width: calc(100% - 250px);
        }

        .page-header {
            background-color: #FFFFFF;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-title {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            font-size: 1.8rem;
            color: #4CAF50;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #8BC34A;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }

        /* Language Switcher */
        .language-switcher {
            margin-right: 20px;
        }

        .language-switcher select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: white;
            font-family: 'Roboto', sans-serif;
        }

        /* Plantix-style Weather Card */
        .weather-card {
            background-color: #FFFFFF;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 25px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .weather-location {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2E2E2E;
            margin-bottom: 5px;
        }

        .weather-date {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .weather-temp {
            font-size: 2.5rem;
            font-weight: 700;
            color: #4CAF50;
        }

        .weather-details {
            text-align: right;
        }

        .weather-condition {
            font-size: 1.1rem;
            color: #2E2E2E;
            margin-bottom: 5px;
        }

        .weather-range {
            color: #666;
            font-size: 0.9rem;
        }

        /* Location Accuracy */
        .location-accuracy {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
        }

        .accuracy-high { color: #4CAF50; }
        .accuracy-medium { color: #FF9800; }
        .accuracy-low { color: #f44336; }

        /* Feature Cards */
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .feature-card {
            background-color: #FFFFFF;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 25px;
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
        }

        .feature-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            gap: 15px;
        }

        .feature-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #E8F5E9;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #4CAF50;
            font-size: 1.5rem;
        }

        .feature-title {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            font-size: 1.3rem;
            color: #2E2E2E;
        }

        .feature-desc {
            color: #666;
            margin-bottom: 15px;
        }

        .feature-list {
            list-style: none;
            margin-top: 15px;
        }

        .feature-list li {
            padding: 8px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .feature-list i {
            color: #4CAF50;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #2E2E2E;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border 0.3s;
            font-family: 'Roboto', sans-serif;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background-color: #4CAF50;
            color: white;
        }

        .btn-primary:hover {
            background-color: #3d8b40;
        }

        .btn-secondary {
            background-color: #FFD700;
            color: #2E2E2E;
        }

        .btn-secondary:hover {
            background-color: #e6c200;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            border-bottom: 3px solid #4CAF50;
            color: #4CAF50;
            font-weight: 600;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Video Upload Section */
        .video-upload-section {
            margin: 20px 0;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 8px;
            border: 2px dashed #4CAF50;
        }

        .custom-badge {
            position: absolute;
            top: 5px;
            left: 5px;
            background: #4CAF50;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.7rem;
            font-weight: bold;
        }

        /* Unavailable Page */
        .unavailable-page {
            display: none;
            text-align: center;
            padding: 50px 20px;
        }

        .unavailable-icon {
            font-size: 5rem;
            color: #8BC34A;
            margin-bottom: 20px;
        }

        .unavailable-title {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            font-size: 2rem;
            margin-bottom: 15px;
            color: #2E2E2E;
        }

        .unavailable-text {
            color: #666;
            margin-bottom: 30px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Results Section */
        .results {
            background-color: #F5F5F5;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }

        .results.active {
            display: block;
        }

        .result-item {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }

        .result-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .result-title {
            font-weight: 600;
            color: #4CAF50;
            margin-bottom: 5px;
        }

        /* Video Grid */
        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .video-card {
            background-color: #F5F5F5;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .video-card:hover {
            transform: translateY(-5px);
        }

        .video-thumbnail {
            width: 100%;
            height: 120px;
            background-color: #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            position: relative;
            overflow: hidden;
        }

        .video-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .video-info {
            padding: 15px;
        }

        .video-title {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 0.9rem;
            height: 40px;
            overflow: hidden;
        }

        .video-meta {
            font-size: 0.8rem;
            color: #666;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: #FFFFFF;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            font-size: 1.5rem;
            color: #2E2E2E;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        /* Tips Section */
        .tips-section {
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            padding: 15px;
            background-color: #F5F5F5;
            border-radius: 8px;
        }

        .tip-item {
            padding: 10px;
            margin-bottom: 10px;
            background-color: white;
            border-radius: 6px;
            border-left: 4px solid #4CAF50;
        }

        .tip-title {
            font-weight: 600;
            color: #4CAF50;
            margin-bottom: 5px;
        }

        /* Row and Column Layout */
        .row {
            display: flex;
            gap: 10px;
        }

        .col {
            flex: 1;
        }

        /* Calculator Sections */
        .calculator-section {
            display: none;
            margin-top: 30px;
        }

        .calculator-section.active {
            display: block;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
            }
            
            .sidebar .logo h1, .nav-item span {
                display: none;
            }
            
            .nav-item {
                justify-content: center;
                padding: 15px 0;
            }
            
            .main-content {
                margin-left: 70px;
                width: calc(100% - 70px);
                padding: 15px;
            }
            
            .features {
                grid-template-columns: 1fr;
            }
            
            .page-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .weather-card {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .weather-details {
                text-align: center;
            }
            
            .row {
                flex-direction: column;
            }
        }

        @media (max-width: 480px) {
            .main-content {
                padding: 10px;
            }
            
            .feature-card, .weather-card {
                padding: 20px;
            }
            
            .video-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar Navigation -->
    <div class="sidebar">
        <div class="logo">
            <h1><i class="fas fa-seedling"></i> <span data-i18n="portal-name">Farmer Portal</span></h1>
        </div>
        <ul class="nav-menu">
            <li class="nav-item active" data-page="home">
                <i class="fas fa-tractor"></i>
                <span data-i18n="your-crops">Your Crops</span>
            </li>
            <li class="nav-item" data-page="disease">
                <i class="fas fa-heartbeat"></i>
                <span data-i18n="heal-crops">Heal Your Crops</span>
            </li>
            <li class="nav-item" data-page="community">
                <i class="fas fa-users"></i>
                <span data-i18n="community">Community</span>
            </li>
            <li class="nav-item" data-page="market">
                <i class="fas fa-shopping-cart"></i>
                <span data-i18n="market">Market</span>
            </li>
            <li class="nav-item" data-page="profile">
                <i class="fas fa-user"></i>
                <span data-i18n="profile">You</span>
            </li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Home Page -->
        <div id="homePage" class="page">
            <div class="page-header">
                <h1 class="page-title" data-i18n="dashboard-title">Your Crops Dashboard</h1>
                <div class="user-info">
                    <div class="language-switcher">
                        <select id="languageSelect">
                            <option value="en">English</option>
                            <option value="hi">हिन्दी (Hindi)</option>
                            <option value="ta">தமிழ் (Tamil)</option>
                            <option value="ml">മലയാളം (Malayalam)</option>
                        </select>
                    </div>
                    <div class="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div>
                        <div class="user-name" data-i18n="welcome">Welcome, Farmer!</div>
                        <div class="user-status">
                            <span id="userLocation">Detecting your location...</span>
                            <div class="location-accuracy" id="locationAccuracy"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Weather Card (Plantix Style) with Dynamic Date -->
            <div class="weather-card">
                <div class="weather-main">
                    <div class="weather-location" id="currentLocation">Detecting location...</div>
                    <div class="weather-date" id="currentDate">Loading date...</div>
                    <div class="weather-temp" id="currentTemp">--°C</div>
                </div>
                <div class="weather-details">
                    <div class="weather-condition" id="weatherCondition">Loading...</div>
                    <div class="weather-range" id="weatherRange">--°C / --°C</div>
                </div>
            </div>

            <h2 style="margin: 30px 0 20px; font-family: 'Poppins', sans-serif; color: #4CAF50;" data-i18n="quick-actions">Quick Actions</h2>
            
            <div class="features">
                <!-- Fertilizer Calculator Card -->
                <div class="feature-card" id="fertilizerCard">
                    <div class="feature-header">
                        <div class="feature-icon">
                            <i class="fas fa-calculator"></i>
                        </div>
                        <h2 class="feature-title" data-i18n="fertilizer-calculator">Fertilizer Calculator</h2>
                    </div>
                    <p class="feature-desc" data-i18n="fertilizer-desc">Calculate the right amount of fertilizer for your crops based on area and soil conditions.</p>
                    <ul class="feature-list">
                        <li><i class="fas fa-check"></i> <span data-i18n="feature-crop-specific">Crop-specific recommendations</span></li>
                        <li><i class="fas fa-check"></i> <span data-i18n="feature-soil-analysis">Soil nutrient analysis</span></li>
                        <li><i class="fas fa-check"></i> <span data-i18n="feature-cost-estimation">Cost estimation</span></li>
                    </ul>
                </div>

                <!-- Pest Control Card -->
                <div class="feature-card" id="pestControlCard">
                    <div class="feature-header">
                        <div class="feature-icon">
                            <i class="fas fa-bug"></i>
                        </div>
                        <h2 class="feature-title" data-i18n="pest-control">Pest Control</h2>
                    </div>
                    <p class="feature-desc" data-i18n="pest-desc">Identify pests and get recommendations for safe and effective control measures.</p>
                    <ul class="feature-list">
                        <li><i class="fas fa-check"></i> <span data-i18n="feature-pesticide-calc">Pesticide calculator</span></li>
                        <li><i class="fas fa-check"></i> <span data-i18n="feature-expert-tips">Expert tips</span></li>
                        <li><i class="fas fa-check"></i> <span data-i18n="feature-safety-guidelines">Safety guidelines</span></li>
                    </ul>
                </div>

                <!-- Video Library Card -->
                <div class="feature-card" id="videoLibraryCard">
                    <div class="feature-header">
                        <div class="feature-icon">
                            <i class="fas fa-video"></i>
                        </div>
                        <h2 class="feature-title" data-i18n="video-library">Video Library</h2>
                    </div>
                    <p class="feature-desc" data-i18n="video-desc">Access educational videos, farmer uploads, and product demonstrations.</p>
                    <ul class="feature-list">
                        <li><i class="fas fa-check"></i> <span data-i18n="feature-tutorials">Farming tutorials</span></li>
                        <li><i class="fas fa-check"></i> <span data-i18n="feature-community-uploads">Community uploads</span></li>
                        <li><i class="fas fa-check"></i> <span data-i18n="feature-product-reviews">Product reviews</span></li>
                    </ul>
                </div>
            </div>

            <!-- Fertilizer Calculator Section (Hidden by default) -->
            <div class="calculator-section" id="fertilizerCalculator">
                <div class="feature-card">
                    <h2 class="feature-title" style="margin-bottom: 20px;" data-i18n="fertilizer-calculator">Fertilizer Calculator</h2>
                    
                    <div class="form-group">
                        <label for="fert-crop" data-i18n="label-crop">Crop</label>
                        <select id="fert-crop">
                            <option value="rice">Rice</option>
                            <option value="wheat">Wheat</option>
                            <option value="maize">Maize</option>
                            <option value="cotton">Cotton</option>
                            <option value="sugarcane">Sugarcane</option>
                            <option value="tomato">Tomato</option>
                        </select>
                    </div>

                    <div class="row">
                        <div class="col">
                            <label for="fert-area" data-i18n="label-area">Area</label>
                            <input id="fert-area" type="number" min="0" step="0.01" placeholder="e.g., 1" />
                        </div>
                        <div style="width: 135px">
                            <label for="fert-unit" data-i18n="label-unit">Unit</label>
                            <select id="fert-unit">
                                <option value="ha">Hectares</option>
                                <option value="acre">Acres</option>
                                <option value="m2">m²</option>
                            </select>
                        </div>
                    </div>

                    <label data-i18n="label-soil-test">Optional: Soil Test (N, P, K in kg/ha)</label>
                    <div class="row">
                        <input id="soil-n" type="number" placeholder="N" min="0" class="col" />
                        <input id="soil-p" type="number" placeholder="P" min="0" class="col" />
                        <input id="soil-k" type="number" placeholder="K" min="0" class="col" />
                    </div>

                    <div class="btn-group">
                        <button id="fert-calc" class="btn btn-primary" data-i18n="button-calculate">Calculate</button>
                        <button id="fert-reset" class="btn btn-secondary" data-i18n="button-reset">Reset</button>
                        <button id="fert-explain-toggle" class="btn btn-secondary" data-i18n="button-explain">Why this amount?</button>
                    </div>

                    <div id="fert-result" class="results">
                        <div class="result-item" id="fert-summary"></div>
                        <div id="fert-breakdown" style="margin-top: 8px"></div>
                        <div id="fert-schedule" style="margin-top: 10px"></div>
                    </div>

                    <div id="fert-explain" style="display: none; margin-top: 15px; padding: 10px; background-color: #E8F5E9; border-radius: 5px;"></div>
                </div>
            </div>

            <!-- Pest Control Section (Hidden by default) -->
            <div class="calculator-section" id="pestControlCalculator">
                <div class="feature-card">
                    <h2 class="feature-title" style="margin-bottom: 20px;" data-i18n="pest-control">Pest Calculator & Tips</h2>
                    
                    <div class="form-group">
                        <label for="pest-crop" data-i18n="label-crop">Crop</label>
                        <select id="pest-crop">
                            <option value="rice">Rice</option>
                            <option value="wheat">Wheat</option>
                            <option value="maize">Maize</option>
                            <option value="cotton">Cotton</option>
                            <option value="tomato">Tomato</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="pest-type" data-i18n="label-pest-type">Pest / Disease Type</label>
                        <select id="pest-type">
                            <option value="stem_borer">Stem Borer</option>
                            <option value="aphids">Aphids</option>
                            <option value="blast">Blast (fungus)</option>
                            <option value="bollworm">Bollworm</option>
                            <option value="leaf_mite">Leaf Mite</option>
                        </select>
                    </div>

                    <div class="row">
                        <div class="col">
                            <label for="infected-percent" data-i18n="label-infected-area">Estimated infected area (%)</label>
                            <input id="infected-percent" type="number" min="0" max="100" step="1" placeholder="e.g., 10" />
                        </div>
                        <div style="width: 160px">
                            <label for="area-pest" data-i18n="label-unit">Area unit</label>
                            <select id="area-pest">
                                <option value="ha">Hectares</option>
                                <option value="acre">Acres</option>
                                <option value="m2">m²</option>
                            </select>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col">
                            <label for="total-area" data-i18n="label-total-area">Total area (same unit)</label>
                            <input id="total-area" type="number" min="0" step="0.01" placeholder="e.g., 1.5" />
                        </div>
                        <div style="width: 160px">
                            <label for="tank-size" data-i18n="label-tank-size">Spray tank size (litres)</label>
                            <input id="tank-size" type="number" min="1" step="1" value="200" />
                        </div>
                    </div>

                    <div style="margin-top: 8px; color: #666; font-size: 0.9rem;" data-i18n="label-area-per-tank">Area that one full tank covers (ha). Change if you know exact coverage per tank.</div>
                    <div class="row" style="margin-top: 6px">
                        <div style="width: 160px">
                            <label for="area-per-tank" data-i18n="label-area-per-tank">Area per tank (ha)</label>
                            <input id="area-per-tank" type="number" min="0.001" step="0.001" value="0.1" />
                        </div>
                        <div style="flex: 1">
                            <label for="pesticide-strength" data-i18n="label-pesticide-strength">Formulation strength (%)</label>
                            <input id="pesticide-strength" type="number" min="0.1" step="0.1" value="36" />
                        </div>
                    </div>

                    <div class="btn-group">
                        <button id="pest-calc" class="btn btn-primary" data-i18n="button-calculate-dose">Calculate Dose</button>
                        <button id="pest-reset" class="btn btn-secondary" data-i18n="button-reset">Reset</button>
                    </div>

                    <div id="pest-result" class="results">
                        <div id="pest-summary" class="result-item"></div>
                        <div id="pest-breakdown" style="margin-top: 8px"></div>
                        <div style="margin-top: 8px; padding: 10px; background-color: #FFEBEE; border-radius: 5px;" id="pest-safety"></div>
                    </div>

                    <!-- Enhanced Tips Section -->
                    <div class="tips-section">
                        <h3 style="margin-bottom: 15px; color: #4CAF50;" data-i18n="pest-management-tips">Pest Management Tips</h3>
                        
                        <div class="tip-item">
                            <div class="tip-title" data-i18n="tip-early-detection">Early Detection</div>
                            <div data-i18n="tip-early-detection-desc">Regularly inspect crops for signs of pests. Early detection allows for more effective and less invasive control methods.</div>
                        </div>
                        
                        <div class="tip-item">
                            <div class="tip-title" data-i18n="tip-cultural-controls">Cultural Controls</div>
                            <div data-i18n="tip-cultural-controls-desc">Practice crop rotation, intercropping, and proper sanitation to disrupt pest life cycles and reduce infestations.</div>
                        </div>
                        
                        <div class="tip-item">
                            <div class="tip-title" data-i18n="tip-biological-controls">Biological Controls</div>
                            <div data-i18n="tip-biological-controls-desc">Introduce natural predators like ladybugs for aphids or use biopesticides derived from natural materials.</div>
                        </div>
                        
                        <div class="tip-item">
                            <div class="tip-title" data-i18n="tip-chemical-controls">Chemical Controls</div>
                            <div data-i18n="tip-chemical-controls-desc">Use pesticides as a last resort. Always follow label instructions, wear proper PPE, and observe pre-harvest intervals.</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Video Library Section -->
            <div class="calculator-section" id="videoLibrarySection">
                <div class="feature-card">
                    <h2 class="feature-title" style="margin-bottom: 20px;" data-i18n="video-library">Video Library</h2>
                    
                    <div class="tabs">
                        <div class="tab active" data-tab="featured" data-i18n="tab-featured">Featured</div>
                        <div class="tab" data-tab="youtube" data-i18n="tab-youtube">YouTube</div>
                        <div class="tab" data-tab="custom" data-i18n="tab-custom">My Videos</div>
                    </div>

                    <!-- Video Upload Section -->
                    <div class="video-upload-section">
                        <h3 style="color: #4CAF50; margin-bottom: 15px;" data-i18n="upload-video">Add Custom Video</h3>
                        
                        <div class="form-group">
                            <label data-i18n="label-video-source">Video Source</label>
                            <select id="videoSource" class="form-control">
                                <option value="youtube">YouTube</option>
                                <option value="vimeo">Vimeo</option>
                                <option value="direct" data-i18n="option-direct">Direct URL</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label data-i18n="label-video-url">Video URL or ID</label>
                            <input type="text" id="videoUrl" placeholder="Enter YouTube URL, Vimeo URL, or direct video URL" class="form-control">
                        </div>
                        
                        <div class="form-group">
                            <label data-i18n="label-video-title">Title</label>
                            <input type="text" id="videoTitle" placeholder="Enter video title" class="form-control">
                        </div>
                        
                        <div class="form-group">
                            <label data-i18n="label-video-desc">Description</label>
                            <textarea id="videoDescription" placeholder="Enter video description" class="form-control" rows="3"></textarea>
                        </div>
                        
                        <button id="addCustomVideo" class="btn btn-primary" style="margin-top: 10px;">
                            <i class="fas fa-plus"></i> <span data-i18n="button-add-video">Add Video to Library</span>
                        </button>
                    </div>

                    <div class="tab-content active" id="featuredTab">
                        <div class="video-grid" id="featuredVideos">
                            <!-- Videos will be loaded here -->
                        </div>
                    </div>

                    <div class="tab-content" id="youtubeTab">
                        <div class="form-group">
                            <label for="youtubeSearch" data-i18n="label-search-yt">Search YouTube for farming videos</label>
                            <div class="row">
                                <input type="text" id="youtubeSearch" placeholder="Enter search terms..." class="col">
                                <button id="searchYoutube" class="btn btn-primary" data-i18n="button-search">Search</button>
                            </div>
                        </div>
                        <div class="video-grid" id="youtubeVideos">
                            <!-- YouTube videos will be loaded here -->
                        </div>
                    </div>

                    <div class="tab-content" id="customTab">
                        <div class="video-grid" id="customVideos">
                            <!-- Custom videos will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Unavailable Pages -->
        <div id="healCropsPage" class="page unavailable-page" style="display: none;">
            <div class="unavailable-icon">
                <i class="fas fa-heartbeat"></i>
            </div>
            <h2 class="unavailable-title" data-i18n="unavailable-health-title">Crop Health Diagnostic</h2>
            <p class="unavailable-text" data-i18n="unavailable-health-text">The crop health diagnostic feature is currently unavailable. Our AI-powered disease detection system is being enhanced for better accuracy.</p>
            <button class="btn btn-primary back-to-home" data-i18n="button-back-home">Back to Home</button>
        </div>

        <div id="communityPage" class="page unavailable-page" style="display: none;">
            <div class="unavailable-icon">
                <i class="fas fa-users"></i>
            </div>
            <h2 class="unavailable-title" data-i18n="unavailable-community-title">Community Feature</h2>
            <p class="unavailable-text" data-i18n="unavailable-community-text">The community feature is currently unavailable. Our team is working hard to bring farmers together in a collaborative space.</p>
            <button class="btn btn-primary back-to-home" data-i18n="button-back-home">Back to Home</button>
        </div>

        <div id="marketPage" class="page unavailable-page" style="display: none;">
            <div class="unavailable-icon">
                <i class="fas fa-shopping-cart"></i>
            </div>
            <h2 class="unavailable-title" data-i18n="unavailable-market-title">Marketplace</h2>
            <p class="unavailable-text" data-i18n="unavailable-market-text">The marketplace feature is currently under development. Soon you'll be able to buy and sell agricultural products directly.</p>
            <button class="btn btn-primary back-to-home" data-i18n="button-back-home">Back to Home</button>
        </div>

        <div id="profilePage" class="page unavailable-page" style="display: none;">
            <div class="unavailable-icon">
                <i class="fas fa-user"></i>
            </div>
            <h2 class="unavailable-title" data-i18n="unavailable-profile-title">Profile Section</h2>
            <p class="unavailable-text" data-i18n="unavailable-profile-text">The profile management feature is currently unavailable. We're building a comprehensive profile system for farmers.</p>
            <button class="btn btn-primary back-to-home" data-i18n="button-back-home">Back to Home</button>
        </div>
    </div>

    <!-- Video Modal -->
    <div class="modal" id="videoModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="videoModalTitle">Video</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div id="videoPlayer" style="width: 100%; height: 400px; background-color: #000;"></div>
        </div>
    </div>

    <script>
        // ==================== MULTILINGUAL SUPPORT ====================
        const translations = {
            en: {
                // Navigation
                'portal-name': 'Farmer Portal',
                'your-crops': 'Your Crops',
                'heal-crops': 'Heal Your Crops',
                'community': 'Community',
                'market': 'Market',
                'profile': 'You',
                
                // Dashboard
                'dashboard-title': 'Your Crops Dashboard',
                'welcome': 'Welcome, Farmer!',
                'quick-actions': 'Quick Actions',
                
                // Feature Cards
                'fertilizer-calculator': 'Fertilizer Calculator',
                'fertilizer-desc': 'Calculate the right amount of fertilizer for your crops based on area and soil conditions.',
                'pest-control': 'Pest Control',
                'pest-desc': 'Identify pests and get recommendations for safe and effective control measures.',
                'video-library': 'Video Library',
                'video-desc': 'Access educational videos, farmer uploads, and product demonstrations.',
                
                // Feature list items
                'feature-crop-specific': 'Crop-specific recommendations',
                'feature-soil-analysis': 'Soil nutrient analysis',
                'feature-cost-estimation': 'Cost estimation',
                'feature-pesticide-calc': 'Pesticide calculator',
                'feature-expert-tips': 'Expert tips',
                'feature-safety-guidelines': 'Safety guidelines',
                'feature-tutorials': 'Farming tutorials',
                'feature-community-uploads': 'Community uploads',
                'feature-product-reviews': 'Product reviews',
                
                // Calculator Labels
                'label-crop': 'Crop',
                'label-area': 'Area',
                'label-unit': 'Unit',
                'label-soil-test': 'Optional: Soil Test (N, P, K in kg/ha)',
                'label-pest-type': 'Pest / Disease Type',
                'label-infected-area': 'Estimated infected area (%)',
                'label-total-area': 'Total area (same unit)',
                'label-tank-size': 'Spray tank size (litres)',
                'label-area-per-tank': 'Area per tank (ha)',
                'label-pesticide-strength': 'Formulation strength (%)',
                
                // Buttons
                'button-calculate': 'Calculate',
                'button-calculate-dose': 'Calculate Dose',
                'button-reset': 'Reset',
                'button-explain': 'Why this amount?',
                'button-search': 'Search',
                'button-back-home': 'Back to Home',
                'button-add-video': 'Add Video to Library',
                
                // Video Library
                'tab-featured': 'Featured',
                'tab-youtube': 'YouTube',
                'tab-custom': 'My Videos',
                'upload-video': 'Add Custom Video',
                'label-video-source': 'Video Source',
                'label-video-url': 'Video URL or ID',
                'label-video-title': 'Title',
                'label-video-desc': 'Description',
                'label-search-yt': 'Search YouTube for farming videos',
                'option-direct': 'Direct URL',
                
                // Pest Tips
                'pest-management-tips': 'Pest Management Tips',
                'tip-early-detection': 'Early Detection',
                'tip-early-detection-desc': 'Regularly inspect crops for signs of pests. Early detection allows for more effective and less invasive control methods.',
                'tip-cultural-controls': 'Cultural Controls',
                'tip-cultural-controls-desc': 'Practice crop rotation, intercropping, and proper sanitation to disrupt pest life cycles and reduce infestations.',
                'tip-biological-controls': 'Biological Controls',
                'tip-biological-controls-desc': 'Introduce natural predators like ladybugs for aphids or use biopesticides derived from natural materials.',
                'tip-chemical-controls': 'Chemical Controls',
                'tip-chemical-controls-desc': 'Use pesticides as a last resort. Always follow label instructions, wear proper PPE, and observe pre-harvest intervals.',
                
                // Unavailable pages
                'unavailable-health-title': 'Crop Health Diagnostic',
                'unavailable-health-text': 'The crop health diagnostic feature is currently unavailable. Our AI-powered disease detection system is being enhanced for better accuracy.',
                'unavailable-community-title': 'Community Feature',
                'unavailable-community-text': 'The community feature is currently unavailable. Our team is working hard to bring farmers together in a collaborative space.',
                'unavailable-market-title': 'Marketplace',
                'unavailable-market-text': 'The marketplace feature is currently under development. Soon you\'ll be able to buy and sell agricultural products directly.',
                'unavailable-profile-title': 'Profile Section',
                'unavailable-profile-text': 'The profile management feature is currently unavailable. We\'re building a comprehensive profile system for farmers.'
            },
            hi: {
                'portal-name': 'किसान पोर्टल',
                'your-crops': 'आपकी फसलें',
                'heal-crops': 'अपनी फसलों को ठीक करें',
                'community': 'समुदाय',
                'market': 'बाजार',
                'profile': 'आप',
                'dashboard-title': 'आपकी फसल डैशबोर्ड',
                'welcome': 'स्वागत है, किसान!',
                'quick-actions': 'त्वरित कार्य',
                'fertilizer-calculator': 'उर्वरक कैलकुलेटर',
                'fertilizer-desc': 'क्षेत्र और मिट्टी की स्थिति के आधार पर अपनी फसलों के लिए उर्वरक की सही मात्रा की गणना करें।',
                'pest-control': 'कीट नियंत्रण',
                'pest-desc': 'कीटों की पहचान करें और सुरक्षित और प्रभावी नियंत्रण उपायों की सिफारिशें प्राप्त करें।',
                'video-library': 'वीडियो लाइब्रेरी',
                'video-desc': 'शैक्षिक वीडियो, किसान अपलोड और उत्पाद प्रदर्शन तक पहुंचें।',
                'feature-crop-specific': 'फसल-विशिष्ट सिफारिशें',
                'feature-soil-analysis': 'मिट्टी पोषक विश्लेषण',
                'feature-cost-estimation': 'लागत अनुमान',
                'feature-pesticide-calc': 'कीटनाशक कैलकुलेटर',
                'feature-expert-tips': 'विशेषज्ञ युक्तियाँ',
                'feature-safety-guidelines': 'सुरक्षा दिशानिर्देश',
                'feature-tutorials': 'खेती ट्यूटोरियल',
                'feature-community-uploads': 'सामुदायिक अपलोड',
                'feature-product-reviews': 'उत्पाद समीक्षाएँ',
                'label-crop': 'फसल',
                'label-area': 'क्षेत्र',
                'label-unit': 'इकाई',
                'label-soil-test': 'वैकल्पिक: मिट्टी परीक्षण (N, P, K किग्रा/हेक्टेयर में)',
                'label-pest-type': 'कीट / रोग प्रकार',
                'label-infected-area': 'अनुमानित संक्रमित क्षेत्र (%)',
                'label-total-area': 'कुल क्षेत्र (समान इकाई)',
                'label-tank-size': 'स्प्रे टैंक आकार (लीटर)',
                'label-area-per-tank': 'प्रति टैंक क्षेत्र (हेक्टेयर)',
                'label-pesticide-strength': 'फॉर्मूलेशन सामर्थ्य (%)',
                'button-calculate': 'गणना करें',
                'button-calculate-dose': 'खुराक गणना करें',
                'button-reset': 'रीसेट',
                'button-explain': 'यह राशि क्यों?',
                'button-search': 'खोजें',
                'button-back-home': 'होम पर वापस जाएं',
                'button-add-video': 'लाइब्रेरी में वीडियो जोड़ें',
                'tab-featured': 'फीचर्ड',
                'tab-youtube': 'यूट्यूब',
                'tab-custom': 'मेरे वीडियो',
                'upload-video': 'कस्टम वीडियो जोड़ें',
                'label-video-source': 'वीडियो स्रोत',
                'label-video-url': 'वीडियो यूआरएल या आईडी',
                'label-video-title': 'शीर्षक',
                'label-video-desc': 'विवरण',
                'label-search-yt': 'कृषि वीडियो के लिए यूट्यूब खोजें',
                'option-direct': 'सीधा यूआरएल',
                'pest-management-tips': 'कीट प्रबंधन युक्तियाँ',
                'tip-early-detection': 'शीघ्र पहचान',
                'tip-early-detection-desc': 'कीटों के संकेतों के लिए नियमित रूप से फसलों का निरीक्षण करें। शीघ्र पहचान अधिक प्रभावी और कम आक्रामक नियंत्रण विधियों की अनुमति देती है।',
                'tip-cultural-controls': 'सांस्कृतिक नियंत्रण',
                'tip-cultural-controls-desc': 'कीट जीवन चक्र को बाधित करने और संक्रमण को कम करने के लिए फसल चक्र, अंतरफसल और उचित स्वच्छता का अभ्यास करें।',
                'tip-biological-controls': 'जैविक नियंत्रण',
                'tip-biological-controls-desc': 'एफिड्स के लिए लेडीबग्स जैसे प्राकृतिक शिकारियों को पेश करें या प्राकृतिक सामग्रियों से प्राप्त जैविक कीटनाशकों का उपयोग करें।',
                'tip-chemical-controls': 'रासायनिक नियंत्रण',
                'tip-chemical-controls-desc': 'अंतिम उपाय के रूप में कीटनाशकों का उपयोग करें। हमेशा लेबल निर्देशों का पालन करें, उचित पीपीई पहनें और फसल कटाई के अंतराल का पालन करें।',
                'unavailable-health-title': 'फसल स्वास्थ्य निदान',
                'unavailable-health-text': 'फसल स्वास्थ्य नैदानिक सुविधा वर्तमान में अनुपलब्ध है। हमारी एआई-संचालित बीमारी पहचान प्रणाली को बेहतर सटीकता के लिए बढ़ाया जा रहा है।',
                'unavailable-community-title': 'सामुदायिक सुविधा',
                'unavailable-community-text': 'सामुदायिक सुविधा वर्तमान में अनुपलब्ध है। हमारी टीम किसानों को एक सहयोगी स्थान पर लाने के लिए कड़ी मेहनत कर रही है।',
                'unavailable-market-title': 'मार्केटप्लेस',
                'unavailable-market-text': 'मार्केटप्लेस सुविधा वर्तमान में विकास के अधीन है। जल्द ही आप सीधे कृषि उत्पाद खरीद और बेच सकेंगे।',
                'unavailable-profile-title': 'प्रोफाइल सेक्शन',
                'unavailable-profile-text': 'प्रोफाइल प्रबंधन सुविधा वर्तमान में अनुपलब्ध है। हम किसानों के लिए एक व्यापक प्रोफाइल सिस्टम बना रहे हैं।'
            },
            ta: {
                'portal-name': 'விவசாயி போர்டல்',
                'your-crops': 'உங்கள் பயிர்கள்',
                'heal-crops': 'உங்கள் பயிர்களை குணப்படுத்துங்கள்',
                'community': 'சமூகம்',
                'market': 'சந்தை',
                'profile': 'நீங்கள்',
                'dashboard-title': 'உங்கள் பயிர் டாஷ்போர்டு',
                'welcome': 'வரவேற்கிறோம், விவசாயி!',
                'quick-actions': 'விரைவு செயல்கள்',
                'fertilizer-calculator': 'உரக் கால்குலேட்டர்',
                'fertilizer-desc': 'பரப்பளவு மற்றும் மண் நிலைகளின் அடிப்படையில் உங்கள் பயிர்களுக்கு தேவையான உரத்தின் சரியான அளவைக் கணக்கிடுங்கள்.',
                'pest-control': 'பூச்சி கட்டுப்பாடு',
                'pest-desc': 'பூச்சிகளை அடையாளம் கண்டு, பாதுகாப்பான மற்றும் பயனுள்ள கட்டுப்பாட்டு நடவடிக்கைகளுக்கான பரிந்துரைகளைப் பெறுங்கள்.',
                'video-library': 'வீடியோ நூலகம்',
                'video-desc': 'கல்வி வீடியோக்கள், விவசாயி பதிவேற்றங்கள் மற்றும் தயாரிப்பு நிரூபணங்களை அணுகவும்.',
                'feature-crop-specific': 'பயிர்-குறிப்பிட்ட பரிந்துரைகள்',
                'feature-soil-analysis': 'மண் ஊட்டச்சத்து பகுப்பாய்வு',
                'feature-cost-estimation': 'செலவு மதிப்பீடு',
                'feature-pesticide-calc': 'பூச்சிக்கொல்லி கால்குலேட்டர்',
                'feature-expert-tips': 'நிபுணர் உதவிக்குறிப்புகள்',
                'feature-safety-guidelines': 'பாதுகாப்பு வழிகாட்டுதல்கள்',
                'feature-tutorials': 'விவசாய பயிற்சிகள்',
                'feature-community-uploads': 'சமூக பதிவேற்றங்கள்',
                'feature-product-reviews': 'தயாரிப்பு மதிப்புரைகள்',
                'label-crop': 'பயிர்',
                'label-area': 'பரப்பளவு',
                'label-unit': 'அலகு',
                'label-soil-test': 'விருப்பத்தேர்வு: மண் சோதனை (N, P, K கிகி/ஹெக்டேரில்)',
                'label-pest-type': 'பூச்சி / நோய் வகை',
                'label-infected-area': 'மதிப்பிடப்பட்ட பாதிப்பு பரப்பளவு (%)',
                'label-total-area': 'மொத்த பரப்பளவு (அதே அலகு)',
                'label-tank-size': 'தெளிப்பு தொட்டி அளவு (லிட்டர்)',
                'label-area-per-tank': 'தொட்டிக்கு பரப்பளவு (ஹெக்டேர்)',
                'label-pesticide-strength': 'தயாரிப்பு வலிமை (%)',
                'button-calculate': 'கணக்கிடு',
                'button-calculate-dose': 'டோஸ் கணக்கிடு',
                'button-reset': 'மீட்டமை',
                'button-explain': 'இந்த தொகை ஏன்?',
                'button-search': 'தேடு',
                'button-back-home': 'முகப்புக்குத் திரும்பு',
                'button-add-video': 'நூலகத்தில் வீடியோ சேர்க்க',
                'tab-featured': 'முன்னிலைப்படுத்தப்பட்டவை',
                'tab-youtube': 'YouTube',
                'tab-custom': 'எனது வீடியோக்கள்',
                'upload-video': 'தனிப்பயன் வீடியோ சேர்க்க',
                'label-video-source': 'வீடியோ மூலம்',
                'label-video-url': 'வீடியோ URL அல்லது ID',
                'label-video-title': 'தலைப்பு',
                'label-video-desc': 'விளக்கம்',
                'label-search-yt': 'விவசாய வீடியோக்களுக்காக YouTube-ல் தேடுங்கள்',
                'option-direct': 'நேரடி URL',
                'pest-management-tips': 'பூச்சி மேலாண்மை உதவிக்குறிப்புகள்',
                'tip-early-detection': 'ஆரம்பகால கண்டறிதல்',
                'tip-early-detection-desc': 'பூச்சிகளின் அறிகுறிகளுக்காக பயிர்களை தவறாமல் பரிசோதிக்கவும். ஆரம்பகால கண்டறிதல் மிகவும் பயனுள்ள மற்றும் குறைவான படையெடுப்பு கட்டுப்பாட்டு முறைகளை அனுமதிக்கிறது.',
                'tip-cultural-controls': 'கலாச்சார கட்டுப்பாடுகள்',
                'tip-cultural-controls-desc': 'பூச்சி வாழ்க்கை சுழற்சியை சீர்குலைக்க மற்றும் தொற்றுநோய்களைக் குறைக்க பயிர் சுழற்சி, இடைப்பயிர் மற்றும் சரியான சுகாதாரத்தைப் பயிற்சி செய்யுங்கள்.',
                'tip-biological-controls': 'உயிரியல் கட்டுப்பாடுகள்',
                'tip-biological-controls-desc': 'அபிட்களுக்கு லேடிபக்ஸ் போன்ற இயற்கை வேட்டையாடுபவர்களை அறிமுகப்படுத்தவும் அல்லது இயற்கை பொருட்களில் இருந்து பெறப்பட்ட உயிர் பூச்சிக்கொல்லிகளைப் பயன்படுத்தவும்.',
                'tip-chemical-controls': 'இரசாயன கட்டுப்பாடுகள்',
                'tip-chemical-controls-desc': 'கடைசி முயற்சியாக பூச்சிக்கொல்லிகளைப் பயன்படுத்தவும். எப்போதும் லேபிள் வழிமுறைகளைப் பின்பற்றவும், சரியான PPE அணியவும், அறுவடைக்கு முன்னர் இடைவெளிகளைக் கவனிக்கவும்.',
                'unavailable-health-title': 'பயிர் சுகாதார நோய் கண்டறிதல்',
                'unavailable-health-text': 'பயிர் சுகாதார நோய் கண்டறிதல் அம்சம் தற்போது கிடைக்கவில்லை. எங்கள் AI-ஆல் இயக்கப்படும் நோய் கண்டறிதல் அமைப்பு சிறந்த துல்லியத்திற்காக மேம்படுத்தப்படுகிறது.',
                'unavailable-community-title': 'சமூக அம்சம்',
                'unavailable-community-text': 'சமூக அம்சம் தற்போது கிடைக்கவில்லை. விவசாயிகளை ஒரு கூட்டுறவு இடத்தில் ஒன்றிணைப்பதற்காக எங்கள் குழு கடினமாக உழைக்கிறது.',
                'unavailable-market-title': 'சந்தை',
                'unavailable-market-text': 'சந்தை அம்சம் தற்போது உருவாக்கத்தில் உள்ளது. விரைவில் நீங்கள் விவசாய பொருட்களை நேரடியாக வாங்கவும் விற்கவும் முடியும்.',
                'unavailable-profile-title': 'சுயவிவர பகுதி',
                'unavailable-profile-text': 'சுயவிவர மேலாண்மை அம்சம் தற்போது கிடைக்கவில்லை. விவசாயிகளுக்கான ஒரு விரிவான சுயவிவர அமைப்பை நாங்கள் உருவாக்குகிறோம்.'
            },
            ml: {
                'portal-name': 'കർഷക പോർട്ടൽ',
                'your-crops': 'നിങ്ങളുടെ വിളകൾ',
                'heal-crops': 'നിങ്ങളുടെ വിളകൾ സുഖപ്പെടുത്തുക',
                'community': 'കമ്മ്യൂണിറ്റി',
                'market': 'മാർക്കറ്റ്',
                'profile': 'നിങ്ങൾ',
                'dashboard-title': 'നിങ്ങളുടെ വിള ഡാഷ്ബോർഡ്',
                'welcome': 'സ്വാഗതം, കർഷകാ!',
                'quick-actions': 'ദ്രുത പ്രവർത്തനങ്ങൾ',
                'fertilizer-calculator': 'എരുവ് കാൽക്കുലേറ്റർ',
                'fertilizer-desc': 'വിസ്തീർണ്ണവും മണ്ണിന്റെ അവസ്ഥയും അടിസ്ഥാനമാക്കി നിങ്ങളുടെ വിളകൾക്ക് ആവശ്യമായ എരുവിന്റെ ശരിയായ അളവ് കണക്കാക്കുക.',
                'pest-control': 'കീട നിയന്ത്രണം',
                'pest-desc': 'കീടങ്ങളെ തിരിച്ചറിയുക, സുരക്ഷിതവും ഫലപ്രദവുമായ നിയന്ത്രണ നടപടികളുടെ ശുപാർശകൾ നേടുക.',
                'video-library': 'വീഡിയോ ലൈബ്രറി',
                'video-desc': 'വിദ്യാഭ്യാസ വീഡിയോകൾ, കർഷക അപ്ലോഡുകൾ, ഉൽപ്പന്ന പ്രദർശനങ്ങൾ എന്നിവ ആക്സസ് ചെയ്യുക.',
                'feature-crop-specific': 'വിള-നിർദ്ദിഷ്ട ശുപാർശകൾ',
                'feature-soil-analysis': 'മണ്ണ് പോഷക വിശകലനം',
                'feature-cost-estimation': 'ചെലവ് കണക്കാക്കൽ',
                'feature-pesticide-calc': 'പെസ്റ്റിസൈഡ് കാൽക്കുലേറ്റർ',
                'feature-expert-tips': 'വിദഗ്ദ്ധോപദേശങ്ങൾ',
                'feature-safety-guidelines': 'സുരക്ഷാ മാർഗ്ഗനിർദ്ദേശങ്ങൾ',
                'feature-tutorials': 'കൃഷി ട്യൂട്ടോറിയലുകൾ',
                'feature-community-uploads': 'കമ്മ്യൂണിറ്റി അപ്ലോഡുകൾ',
                'feature-product-reviews': 'ഉൽപ്പന്ന അവലോകനങ്ങൾ',
                'label-crop': 'വിള',
                'label-area': 'വിസ്തീർണ്ണം',
                'label-unit': 'യൂണിറ്റ്',
                'label-soil-test': 'ഓപ്ഷണൽ: മണ്ണ് പരിശോധന (N, P, K kg/ha-ൽ)',
                'label-pest-type': 'കീടം / രോഗം തരം',
                'label-infected-area': 'കണക്കാക്കിയ ബാധിത പ്രദേശം (%)',
                'label-total-area': 'ആകെ വിസ്തീർണ്ണം (അതേ യൂണിറ്റ്)',
                'label-tank-size': 'സ്പ്രേ ടാങ്ക് വലുപ്പം (ലിറ്റർ)',
                'label-area-per-tank': 'ഓരോ ടാങ്കിനും വിസ്തീർണ്ണം (ഹെക്ടർ)',
                'label-pesticide-strength': 'ഫോർമുലേഷൻ ശക്തി (%)',
                'button-calculate': 'കണക്കുകൂട്ടുക',
                'button-calculate-dose': 'ഡോസ് കണക്കുകൂട്ടുക',
                'button-reset': 'റീസെറ്റ്',
                'button-explain': 'ഈ തുക എന്തുകൊണ്ട്?',
                'button-search': 'തിരയുക',
                'button-back-home': 'ഹോമിലേക്ക് മടങ്ങുക',
                'button-add-video': 'ലൈബ്രറിയിൽ വീഡിയോ ചേർക്കുക',
                'tab-featured': 'ഫീച്ചർ ചെയ്തത്',
                'tab-youtube': 'YouTube',
                'tab-custom': 'എന്റെ വീഡിയോകൾ',
                'upload-video': 'കസ്റ്റം വീഡിയോ ചേർക്കുക',
                'label-video-source': 'വീഡിയോ സ്രോതസ്സ്',
                'label-video-url': 'വീഡിയോ URL അല്ലെങ്കിൽ ID',
                'label-video-title': 'തലക്കെട്ട്',
                'label-video-desc': 'വിവരണം',
                'label-search-yt': 'കൃഷി വീഡിയോകൾക്കായി YouTube-ൽ തിരയുക',
                'option-direct': 'നേരിട്ടുള്ള URL',
                'pest-management-tips': 'കീട മാനേജ്മെന്റ് ടിപ്പുകൾ',
                'tip-early-detection': 'ആദ്യകാല കണ്ടെത്തൽ',
                'tip-early-detection-desc': 'കീടങ്ങളുടെ അടയാളങ്ങൾക്കായി വിളകൾ നിയമിതമായി പരിശോധിക്കുക. ആദ്യകാല കണ്ടെത്തൽ കൂടുതൽ ഫലപ്രദവും കുറഞ്ഞ ഇടപെടലും ഉള്ള നിയന്ത്രണ രീതികളെ അനുവദിക്കുന്നു.',
                'tip-cultural-controls': 'സാംസ്കാരിക നിയന്ത്രണങ്ങൾ',
                'tip-cultural-controls-desc': 'കീട ജീവിതചക്രത്തെ തടസ്സപ്പെടുത്താനും ബാധകൾ കുറയ്ക്കാനും വിള കറക്കം, ഇന്റർക്രോപ്പിംഗ്, ശരിയായ ശുചിത്വം എന്നിവ പ്രയോഗിക്കുക.',
                'tip-biological-controls': 'ജൈവിക നിയന്ത്രണങ്ങൾ',
                'tip-biological-controls-desc': 'ആഫിഡുകൾക്ക് ലേഡിബഗ്സ് പോലുള്ള സ്വാഭാവിക ഇരപിടിയന്മാരെ പരിചയപ്പെടുത്തുക അല്ലെങ്കിൽ സ്വാഭാവിക വസ്തുക്കളിൽ നിന്ന് ലഭിക്കുന്ന ബയോപെസ്റ്റിസൈഡുകൾ ഉപയോഗിക്കുക.',
                'tip-chemical-controls': 'രാസ നിയന്ത്രണങ്ങൾ',
                'tip-chemical-controls-desc': 'അവസാന ഉപാധിയായി പെസ്റ്റിസൈഡുകൾ ഉപയോഗിക്കുക. എല്ലായ്പ്പോഴും ലേബൽ നിർദ്ദേശങ്ങൾ പാലിക്കുക, ഉചിതമായ PPE ധരിക്കുക, വിളവെടുപ്പിന് മുമ്പുള്ള ഇടവേളകൾ നിരീക്ഷിക്കുക.',
                'unavailable-health-title': 'വിള ആരോഗ്യ ഡയഗ്നോസ്റ്റിക്',
                'unavailable-health-text': 'വിള ആരോഗ്യ ഡയഗ്നോസ്റ്റിക് സവിശേഷത നിലവിൽ ലഭ്യമല്ല. ഞങ്ങളുടെ AI-പവർ ചെയ്ത രോഗം കണ്ടെത്തൽ സംവിധാനം മികച്ച കൃത്യതയ്ക്കായി വർദ്ധിപ്പിക്കുന്നു.',
                'unavailable-community-title': 'കമ്മ്യൂണിറ്റി സവിശേഷത',
                'unavailable-community-text': 'കമ്മ്യൂണിറ്റി സവിശേഷത നിലവിൽ ലഭ്യമല്ല. കർഷകരെ ഒരു സഹകരണ സ്ഥലത്ത് ഒന്നിച്ചുകൂട്ടുന്നതിന് ഞങ്ങളുടെ ടീം കഠിനമായി പ്രവർത്തിക്കുന്നു.',
                'unavailable-market-title': 'മാർക്കറ്റ്പ്ലേസ്',
                'unavailable-market-text': 'മാർക്കറ്റ്പ്ലേസ് സവിശേഷത നിലവിൽ വികസനത്തിലാണ്. ഉടൻ തന്നെ നിങ്ങൾക്ക് കാർഷിക ഉൽപ്പന്നങ്ങൾ നേരിട്ട് വാങ്ങാനും വിൽക്കാനും കഴിയും.',
                'unavailable-profile-title': 'പ്രൊഫൈൽ വിഭാഗം',
                'unavailable-profile-text': 'പ്രൊഫൈൽ മാനേജ്മെന്റ് സവിശേഷത നിലവിൽ ലഭ്യമല്ല. കർഷകർക്കായി ഒരു സമഗ്ര പ്രൊഫൈൽ സിസ്റ്റം ഞങ്ങൾ നിർമ്മിക്കുന്നു.'
            }
        };

        // ==================== LANGUAGE MANAGEMENT ====================
        function applyLanguage(lang) {
            localStorage.setItem('preferredLanguage', lang);
            document.documentElement.lang = lang;
            
            // Update all translatable elements
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (translations[lang] && translations[lang][key]) {
                    element.textContent = translations[lang][key];
                }
            });
            
            // Update select element
            document.getElementById('languageSelect').value = lang;
        }

        // ==================== ENHANCED LOCATION DETECTION ====================
        async function getEnhancedLocation() {
            try {
                // Try high-accuracy GPS first
                const position = await new Promise((resolve, reject) => {
                    navigator.geolocation.getCurrentPosition(resolve, reject, {
                        enableHighAccuracy: true,
                        timeout: 15000,
                        maximumAge: 60000
                    });
                });

                const lat = position.coords.latitude;
                const lon = position.coords.longitude;
                const accuracy = position.coords.accuracy;

                // Update accuracy indicator
                updateAccuracyIndicator(accuracy);

                // Try multiple geocoding services
                const location = await getAccurateLocationName(lat, lon);
                return location;

            } catch (error) {
                console.log('GPS failed, trying IP-based location...');
                return await getIPBasedLocation();
            }
        }

        async function getAccurateLocationName(lat, lon) {
            const services = [
                `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`,
                `https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lon}&localityLanguage=en`
            ];

            for (const service of services) {
                try {
                    const response = await fetch(service);
                    const data = await response.json();
                    
                    if (service.includes('nominatim')) {
                        if (data.address) {
                            return formatNominatimLocation(data.address);
                        }
                    } else {
                        if (data.locality) {
                            return {
                                name: data.locality,
                                city: data.city,
                                region: data.principalSubdivision,
                                country: data.countryName
                            };
                        }
                    }
                } catch (error) {
                    console.log(`Service failed: ${service}`);
                }
            }
            throw new Error('All geocoding services failed');
        }

        function formatNominatimLocation(address) {
            let locationName = '';
            
            // Priority-based location naming
            if (address.village) locationName = address.village;
            else if (address.town) locationName = address.town;
            else if (address.city) locationName = address.city;
            else if (address.municipality) locationName = address.municipality;
            else if (address.county) locationName = address.county;
            
            if (address.state && locationName !== address.state) {
                locationName += `, ${address.state}`;
            }
            
            return {
                name: locationName,
                city: address.city || address.town || address.village,
                region: address.state,
                country: address.country
            };
        }

        // Fallback to IP-based location
        async function getIPBasedLocation() {
            try {
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();
                
                const location = {
                    name: `${data.city}, ${data.region}`,
                    city: data.city,
                    region: data.region,
                    country: data.country_name
                };
                
                return location;
            } catch (error) {
                return setDefaultLocation();
            }
        }

        function updateAccuracyIndicator(accuracy) {
            const accuracyElement = document.getElementById('locationAccuracy');
            if (accuracy < 100) {
                accuracyElement.innerHTML = `<span class="accuracy-high">High accuracy</span>`;
            } else if (accuracy < 1000) {
                accuracyElement.innerHTML = `<span class="accuracy-medium">Medium accuracy</span>`;
            } else {
                accuracyElement.innerHTML = `<span class="accuracy-low">Low accuracy</span>`;
            }
        }

        function updateLocationUI(location) {
            document.getElementById('userLocation').textContent = location.name;
            document.getElementById('currentLocation').textContent = location.name;
            
            // Store for later use
            window.currentLocation = location;
        }

        function setDefaultLocation() {
            const defaultLocation = {
                name: 'Chennai, Tamil Nadu',
                city: 'Chennai',
                region: 'Tamil Nadu',
                country: 'India'
            };
            
            updateLocationUI(defaultLocation);
            document.getElementById('locationAccuracy').innerHTML = `<span class="accuracy-low">Default location</span>`;
            return defaultLocation;
        }

        // ==================== VIDEO LIBRARY ENHANCEMENTS ====================
        class VideoLibraryManager {
            constructor() {
                this.customVideos = JSON.parse(localStorage.getItem('customVideos')) || [];
                this.init();
            }

            init() {
                this.loadCustomVideos();
            }

            addCustomVideo() {
                const source = document.getElementById('videoSource').value;
                const url = document.getElementById('videoUrl').value.trim();
                const title = document.getElementById('videoTitle').value.trim();
                const description = document.getElementById('videoDescription').value.trim();

                if (!url || !title) {
                    alert('Please enter both URL and title');
                    return;
                }

                const videoData = {
                    id: 'custom_' + Date.now(),
                    source: source,
                    url: url,
                    title: title,
                    description: description,
                    thumbnail: this.generateThumbnail(source, url),
                    custom: true,
                    timestamp: new Date().toISOString()
                };

                this.customVideos.push(videoData);
                this.saveCustomVideos();
                this.loadCustomVideos();

                // Clear form
                document.getElementById('videoUrl').value = '';
                document.getElementById('videoTitle').value = '';
                document.getElementById('videoDescription').value = '';

                alert('Video added to library successfully!');
            }

            generateThumbnail(source, url) {
                if (source === 'youtube') {
                    const videoId = this.extractYouTubeId(url);
                    return videoId ? `https://img.youtube.com/vi/${videoId}/hqdefault.jpg` : '';
                }
                return 'https://via.placeholder.com/300x169?text=Video';
            }

            extractYouTubeId(url) {
                const regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/;
                const match = url.match(regex);
                return match ? match[1] : null;
            }

            loadCustomVideos() {
                const customContainer = document.getElementById('customVideos');
                if (!customContainer) return;

                customContainer.innerHTML = '';

                this.customVideos.forEach(video => {
                    const videoCard = this.createCustomVideoCard(video);
                    customContainer.appendChild(videoCard);
                });
            }

            createCustomVideoCard(video) {
                const card = document.createElement('div');
                card.className = 'video-card';
                card.innerHTML = `
                    <div class="video-thumbnail" style="position:relative;">
                        <img src="${video.thumbnail}" alt="${video.title}" onerror="this.src='https://via.placeholder.com/300x169?text=Video'">
                        <div class="custom-badge">My Video</div>
                    </div>
                    <div class="video-info">
                        <div class="video-title">${video.title}</div>
                        <div class="video-description">${video.description}</div>
                        <div class="video-meta">Added: ${new Date(video.timestamp).toLocaleDateString()}</div>
                    </div>
                `;
                
                card.addEventListener('click', () => this.playCustomVideo(video));
                return card;
            }

            playCustomVideo(video) {
                let embedUrl = '';
                
                switch(video.source) {
                    case 'youtube':
                        const videoId = this.extractYouTubeId(video.url);
                        embedUrl = `https://www.youtube.com/embed/${videoId}`;
                        break;
                    case 'vimeo':
                        const vimeoId = video.url.split('/').pop();
                        embedUrl = `https://player.vimeo.com/video/${vimeoId}`;
                        break;
                    case 'direct':
                        embedUrl = video.url;
                        break;
                }

                if (embedUrl) {
                    openVideoModal({
                        title: video.title,
                        videoId: embedUrl,
                        custom: true
                    });
                }
            }

            saveCustomVideos() {
                localStorage.setItem('customVideos', JSON.stringify(this.customVideos));
            }
        }

        // ==================== CALCULATOR LOGIC ====================
        function toHectares(value, unit){
            if (!value || isNaN(value) || value <= 0) return 0;
            value = Number(value);
            switch(unit){
                case 'ha': return value;
                case 'acre': return value * 0.40468564224;
                case 'm2': return value / 10000;
                default: return value;
            }
        }

        function round(x, dp=2){ 
            return Math.round((x + Number.EPSILON) * Math.pow(10,dp)) / Math.pow(10,dp); 
        }

        // Base recommendations (kg nutrient per hectare)
        const baseNPKperHa = {
            rice: {N:120, P:60, K:60},
            wheat: {N:100, P:50, K:40},
            maize: {N:140, P:60, K:50},
            cotton: {N:100, P:60, K:60},
            sugarcane: {N:150, P:70, K:200},
            tomato: {N:120, P:70, K:80}
        };

        // Fertilizer formulations & prices
        const fertilizers = [
            { code:'urea', name:'Urea (46% N)', nutrient:'N', pct:46, pricePerKg:30 },
            { code:'dap',  name:'DAP (18% N, 46% P2O5 ~ 20% P)', nutrient:'P', pct:20, pricePerKg:45 },
            { code:'mop',  name:'MOP (60% K2O ~ 50% K)', nutrient:'K', pct:50, pricePerKg:25 }
        ];

        function calcFertilizerRecommendation(crop, areaHa, soil){
            const base = baseNPKperHa[crop];
            if(!base) return null;

            const reqN = Math.max(0, base.N - (soil?.N || 0));
            const reqP = Math.max(0, base.P - (soil?.P || 0));
            const reqK = Math.max(0, base.K - (soil?.K || 0));

            const totN = reqN * areaHa;
            const totP = reqP * areaHa;
            const totK = reqK * areaHa;

            const ureaKg = totN / (fertilizers.find(f=>f.code==='urea').pct/100);
            const dapKg  = totP / (fertilizers.find(f=>f.code==='dap').pct/100);
            const mopKg  = totK / (fertilizers.find(f=>f.code==='mop').pct/100);

            const schedule = [
                { when: 'Basal (before/at sowing)', items: [{name:'DAP', kg: round(dapKg,2)}, {name:'MOP', kg: round(mopKg,2)}] },
                { when: 'Top-dressing (1)', items: [{name:'Urea', kg: round(ureaKg*0.6,2)}] },
                { when: 'Top-dressing (2)', items: [{name:'Urea', kg: round(ureaKg*0.4,2)}] }
            ];

            const totalCost = round(
                ureaKg * fertilizers.find(f=>f.code==='urea').pricePerKg +
                dapKg  * fertilizers.find(f=>f.code==='dap').pricePerKg +
                mopKg  * fertilizers.find(f=>f.code==='mop').pricePerKg, 2
            );

            return {
                areaHa,
                reqN, reqP, reqK,
                totals: { ureaKg: round(ureaKg,2), dapKg: round(dapKg,2), mopKg: round(mopKg,2) },
                schedule, totalCost
            };
        }

        // Pest logic
        const pestDefaults = {
            stem_borer: { name:'Stem Borer', mlPerHa: 300 },
            aphids:     { name:'Aphids', mlPerHa: 250 },
            blast:      { name:'Blast (fungus)', mlPerHa: 400 },
            bollworm:   { name:'Bollworm', mlPerHa: 350 },
            leaf_mite:  { name:'Leaf Mite', mlPerHa: 200 }
        };

        // ==================== UTILITY FUNCTIONS ====================
        function updateDate() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('en-US', options);
        }

        function updateWeather() {
            // In a real implementation, this would fetch from a weather API
            const temperatures = [28, 29, 30, 31, 32, 33, 34, 35];
            const conditions = ['Moderate', 'Partly Cloudy', 'Cloudy', 'Rainy'];
            const minTemp = 27;
            const maxTemp = 35;
            
            // Simulate random weather data
            const randomTemp = temperatures[Math.floor(Math.random() * temperatures.length)];
            const randomCondition = conditions[Math.floor(Math.random() * conditions.length)];
            
            document.getElementById('currentTemp').textContent = `${randomTemp}°C`;
            document.getElementById('weatherCondition').textContent = randomCondition;
            document.getElementById('weatherRange').textContent = `${minTemp}°C / ${maxTemp}°C`;
        }

        function hideAllCalculators() {
            document.querySelectorAll('.calculator-section').forEach(section => {
                section.classList.remove('active');
            });
        }

        // Utility: build YouTube link
        function youtubeLink(videoId) {
            return `https://www.youtube.com/watch?v=${encodeURIComponent(videoId)}`;
        }

        // Load featured videos
        function loadFeaturedVideos() {
            const featuredVideosContainer = document.getElementById('featuredVideos');
            featuredVideosContainer.innerHTML = '';

            // Sample featured videos (farming-based)
            const featuredVideos = [
                {
                    title: 'Organic Farming Basics',
                    videoId: 'quMNdpNatuM',
                    thumbnail: 'https://img.youtube.com/vi/quMNdpNatuM/hqdefault.jpg',
                    duration: '15:30',
                    channel: 'AgriExpert'
                },
                {
                    title: 'Soil Health Management Tips',
                    videoId: '0js09p2s0Lc',
                    thumbnail: 'https://img.youtube.com/vi/0js09p2s0Lc/hqdefault.jpg',
                    duration: '22:15',
                    channel: 'FarmTech'
                },
                {
                    title: 'Modern Irrigation Techniques',
                    videoId: 'Blb0_8ZcMwc',
                    thumbnail: 'https://img.youtube.com/vi/Blb0_8ZcMwc/hqdefault.jpg',
                    duration: '18:45',
                    channel: 'WaterWise'
                },
                {
                    title: 'Effective Pest Control Strategies',
                    videoId: 'JXEtmKRnMZk',
                    thumbnail: 'https://img.youtube.com/vi/JXEtmKRnMZk/hqdefault.jpg',
                    duration: '12:20',
                    channel: 'CropCare'
                }
            ];

            featuredVideos.forEach(video => {
                const videoCard = createVideoCard(video);
                featuredVideosContainer.appendChild(videoCard);
            });
        }

        // Load YouTube videos dynamically (simulated)
        function loadYouTubeVideos(query) {
            const youtubeVideosContainer = document.getElementById('youtubeVideos');
            youtubeVideosContainer.innerHTML = '<div style="text-align: center; padding: 20px;">Loading videos...</div>';

            // Simulate API call with sample data
            setTimeout(() => {
                youtubeVideosContainer.innerHTML = '';

                const youtubeVideos = [
                    {
                        title: `${query} - Farming in India`,
                        videoId: 'nNP4o1wE6Vo',
                        thumbnail: 'https://img.youtube.com/vi/nNP4o1wE6Vo/hqdefault.jpg',
                        duration: '10:25',
                        channel: 'YouTube Farmer'
                    },
                    {
                        title: `Advanced ${query} Techniques`,
                        videoId: 'jOv9JGGPhoQ',
                        thumbnail: 'https://img.youtube.com/vi/jOv9JGGPhoQ/hqdefault.jpg',
                        duration: '15:40',
                        channel: 'AgriPro'
                    },
                    {
                        title: `${query} for Beginners`,
                        videoId: '2F74xw1VK8E',
                        thumbnail: 'https://img.youtube.com/vi/2F74xw1VK8E/hqdefault.jpg',
                        duration: '8:15',
                        channel: 'Farming 101'
                    },
                    {
                        title: `Modern ${query} Methods`,
                        videoId: 'zeSRhgRSRJI',
                        thumbnail: 'https://img.youtube.com/vi/zeSRhgRSRJI/hqdefault.jpg',
                        duration: '12:30',
                        channel: 'Future Farms'
                    }
                ];

                youtubeVideos.forEach(video => {
                    const videoCard = createVideoCard(video);
                    youtubeVideosContainer.appendChild(videoCard);
                });
            }, 1000);
        }

        // Create video card element
        function createVideoCard(video) {
            const videoCard = document.createElement('div');
            videoCard.className = 'video-card';
            
            // Create a wrapper link that opens the video in a new tab
            const videoLink = document.createElement('a');
            videoLink.href = youtubeLink(video.videoId);
            videoLink.target = '_blank';
            videoLink.rel = 'noopener noreferrer';
            videoLink.style.textDecoration = 'none';
            videoLink.style.color = 'inherit';
            videoLink.style.display = 'block';
            
            videoLink.innerHTML = `
                <div class="video-thumbnail" style="position:relative;">
                    <img src="${video.thumbnail}" alt="${video.title}">
                    <div style="position: absolute; bottom: 5px; right: 5px; background: rgba(0,0,0,0.7); color: white; padding: 2px 5px; border-radius: 3px; font-size: 0.7rem;">
                        ${video.duration}
                    </div>
                </div>
                <div class="video-info">
                    <div class="video-title">${video.title}</div>
                    <div class="video-meta">${video.channel}</div>
                </div>
            `;

            videoCard.appendChild(videoLink);
            
            // Keep the modal functionality for a better user experience
            videoCard.addEventListener('click', function(e) {
                // Only open modal if the link wasn't clicked directly
                if (!e.target.closest('a')) {
                    openVideoModal(video);
                }
            });

            return videoCard;
        }

        // Open video modal
        function openVideoModal(video) {
            const modal = document.getElementById('videoModal');
            const title = modal.querySelector('.modal-title');
            const iframe = modal.querySelector('#videoPlayer');

            title.textContent = video.title;
            iframe.innerHTML = `<iframe width="100%" height="100%" src="https://www.youtube.com/embed/${video.videoId}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;
            modal.style.display = 'flex';
        }

        // Close modal
        document.querySelector('.close-modal').addEventListener('click', function() {
            closeVideoModal();
        });

        // Close modal when clicking outside
        window.addEventListener('click', function(event) {
            if (event.target === document.getElementById('videoModal')) {
                closeVideoModal();
            }
        });

        // Close video modal function
        function closeVideoModal() {
            const modal = document.getElementById('videoModal');
            const iframe = modal.querySelector('#videoPlayer');

            iframe.innerHTML = ''; // clears the video so it stops playing
            modal.style.display = 'none';
        }

        // Show specific page
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.style.display = 'none';
            });

            document.getElementById(pageId).style.display = 'block';
        }

        // Set active navigation item
        function setActiveNav(activePage) {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            document.querySelector(`.nav-item[data-page="${activePage}"]`).classList.add('active');
        }

        // Dynamic redirect function
        function redirectTo(page, delay = 0) {
            setTimeout(() => {
                if (window.location.href.startsWith("file:") || window.location.href.includes("5500")) {
                    // VS Code Live Server / direct HTML
                    window.location.href = page + ".html";
                } else {
                    // Flask routes
                    window.location.href = "/" + page;
                }
            }, delay);
        }

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize language system
            const savedLang = localStorage.getItem('preferredLanguage') || 'en';
            applyLanguage(savedLang);

            // Initialize video library manager
            window.videoLibraryManager = new VideoLibraryManager();

            // Update location with enhanced detection
            getEnhancedLocation().then(location => {
                updateLocationUI(location);
            }).catch(error => {
                setDefaultLocation();
            });

            // Update date and weather
            updateDate();
            updateWeather();

            // Event listeners
            document.getElementById('languageSelect').addEventListener('change', (e) => {
                applyLanguage(e.target.value);
            });

            document.getElementById('addCustomVideo').addEventListener('click', () => {
                window.videoLibraryManager.addCustomVideo();
            });

            // Navigation setup
            const navItems = document.querySelectorAll('.nav-item');
            
            navItems.forEach(item => {
                item.addEventListener('click', function() {
                    const page = this.getAttribute('data-page');
                    
                    if (page === 'home') {
                        showPage('homePage');
                        hideAllCalculators();
                        setActiveNav('home');
                    } else {
                        redirectTo(page);
                    }
                });
            });
            
            // Feature card clicks - show calculators
            document.getElementById('fertilizerCard').addEventListener('click', function() {
                hideAllCalculators();
                document.getElementById('fertilizerCalculator').classList.add('active');
                document.getElementById('fertilizerCalculator').scrollIntoView({ behavior: 'smooth' });
            });
            
            document.getElementById('pestControlCard').addEventListener('click', function() {
                hideAllCalculators();
                document.getElementById('pestControlCalculator').classList.add('active');
                document.getElementById('pestControlCalculator').scrollIntoView({ behavior: 'smooth' });
            });
            
            document.getElementById('videoLibraryCard').addEventListener('click', function() {
                hideAllCalculators();
                document.getElementById('videoLibrarySection').classList.add('active');
                document.getElementById('videoLibrarySection').scrollIntoView({ behavior: 'smooth' });
                loadFeaturedVideos();
            });
            
            // Back to home buttons
            document.querySelectorAll('.back-to-home').forEach(button => {
                button.addEventListener('click', function() {
                    showPage('homePage');
                    setActiveNav('home');
                    hideAllCalculators();
                });
            });
            
            // Tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    
                    document.querySelectorAll('.tab').forEach(t => {
                        t.classList.remove('active');
                    });
                    
                    this.classList.add('active');
                    
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    document.getElementById(tabName + 'Tab').classList.add('active');
                    
                    // Load videos when YouTube tab is selected
                    if (tabName === 'youtube') {
                        loadYouTubeVideos('farming techniques');
                    }
                });
            });
            
            // Fertilizer calculator functionality
            document.getElementById('fert-calc').addEventListener('click', function() {
                const crop = document.getElementById('fert-crop').value;
                const areaVal = parseFloat(document.getElementById('fert-area').value);
                const unit = document.getElementById('fert-unit').value;
                
                if(!areaVal || areaVal <= 0){ 
                    alert('Enter a valid area'); 
                    return; 
                }
                
                const areaHa = toHectares(areaVal, unit);

                const soil = {};
                const nVal = Number(document.getElementById('soil-n').value); 
                if(nVal) soil.N = nVal;
                const pVal = Number(document.getElementById('soil-p').value); 
                if(pVal) soil.P = pVal;
                const kVal = Number(document.getElementById('soil-k').value); 
                if(kVal) soil.K = kVal;

                const rec = calcFertilizerRecommendation(crop, areaHa, (Object.keys(soil).length?soil:null));
                if(!rec){ 
                    alert('No recommendation logic for selected crop'); 
                    return; 
                }

                document.getElementById('fert-summary').innerHTML = `For <strong>${areaVal} ${unit} of ${crop}</strong> (≈ ${round(areaHa,4)} ha)`;
                document.getElementById('fert-breakdown').innerHTML = `
                    <div><strong>Recommended fertilizer (total):</strong></div>
                    <div class="result-item">Urea: ${rec.totals.ureaKg} kg</div>
                    <div class="result-item">DAP: ${rec.totals.dapKg} kg</div>
                    <div class="result-item">MOP: ${rec.totals.mopKg} kg</div>
                    <div style="margin-top:8px"><strong>Estimated cost:</strong> ₹ ${rec.totalCost}</div>
                `;
                
                let schedHtml = '<strong>Application schedule:</strong><ul style="padding-left:16px">';
                rec.schedule.forEach(s=>{
                    schedHtml += `<li style="margin:6px 0"><strong>${s.when}:</strong> ${s.items.map(it => `${it.name} ${it.kg} kg`).join(', ')}</li>`;
                });
                schedHtml += '</ul>';
                document.getElementById('fert-schedule').innerHTML = schedHtml;
                
                document.getElementById('fert-explain').innerText = `Calculation: base nutrient need (kg/ha) for ${crop} multiplied by area → subtract soil test values (if provided). Then nutrient mass converted to fertilizer mass using typical formulation percentages. Prices are sample values.`;
                
                document.getElementById('fert-result').classList.add('active');
            });
            
            document.getElementById('fert-reset').addEventListener('click', function() {
                document.getElementById('fert-area').value = '';
                document.getElementById('soil-n').value = '';
                document.getElementById('soil-p').value = '';
                document.getElementById('soil-k').value = '';
                document.getElementById('fert-result').classList.remove('active');
            });
            
            document.getElementById('fert-explain-toggle').addEventListener('click', function() {
                const explanation = document.getElementById('fert-explain');
                explanation.style.display = explanation.style.display === 'none' ? 'block' : 'none';
            });
            
            // Pest control functionality
            document.getElementById('pest-calc').addEventListener('click', function() {
                const crop = document.getElementById('pest-crop').value;
                const pest = document.getElementById('pest-type').value;
                const infectedPct = Number(document.getElementById('infected-percent').value) || 0;
                const unit = document.getElementById('area-pest').value;
                const areaVal = Number(document.getElementById('total-area').value);
                
                if(!areaVal || areaVal <= 0){ 
                    alert('Enter total area to treat'); 
                    return; 
                }
                
                const areaHa = toHectares(areaVal, unit);
                const affectedHa = areaHa * (Math.min(100, Math.max(0, infectedPct)) / 100 );

                const def = pestDefaults[pest];
                if(!def){ 
                    alert('No defaults for this pest'); 
                    return; 
                }
                
                const mlPerHa = def.mlPerHa;
                const totalMl = mlPerHa * affectedHa;

                const areaPerTank = Number(document.getElementById('area-per-tank').value) || 0.1;
                const tankSize = Number(document.getElementById('tank-size').value) || 200;
                const perTankMl = mlPerHa * areaPerTank;

                const formattedTotal = round(totalMl,2);
                const formattedPerTank = round(perTankMl,2);

                document.getElementById('pest-summary').innerHTML = `Pest: <strong>${def.name}</strong> on <strong>${round(affectedHa,3)} ha</strong> affected area.`;
                document.getElementById('pest-breakdown').innerHTML = `
                    <div><strong>Recommended formulation:</strong> ${mlPerHa} ml per hectare</div>
                    <div style="margin-top:8px"><strong>Total pesticide required:</strong> ${formattedTotal} ml (for ${round(affectedHa,3)} ha)</div>
                    <div><strong>Mix per tank (tank size ${tankSize} L, covers ${areaPerTank} ha):</strong> ${formattedPerTank} ml per full tank</div>
                    <div style="margin-top:6px"><strong>Number of full tanks needed:</strong> ${ areaPerTank>0 ? round(affectedHa/areaPerTank,2) : '—' }</div>
                `;

                document.getElementById('pest-safety').innerHTML = `<strong>Safety:</strong> Wear PPE, avoid spraying under windy conditions, follow label waiting period. Formulation strength input is for reference only — always follow the registered product label.`;

                document.getElementById('pest-result').classList.add('active');
            });
            
            document.getElementById('pest-reset').addEventListener('click', function() {
                document.getElementById('infected-percent').value = '';
                document.getElementById('total-area').value = '';
                document.getElementById('tank-size').value = '200';
                document.getElementById('area-per-tank').value = '0.1';
                document.getElementById('pesticide-strength').value = '36';
                document.getElementById('pest-result').classList.remove('active');
            });
            
            // YouTube search
            document.getElementById('searchYoutube').addEventListener('click', function() {
                const query = document.getElementById('youtubeSearch').value;
                if (query) {
                    loadYouTubeVideos(query);
                }
            });
        });
    </script>

    <!-- Chatbase Chatbot Script -->
    <script>
        (function(){if(!window.chatbase||window.chatbase("getState")!=="initialized"){window.chatbase=(...arguments)=>{if(!window.chatbase.q){window.chatbase.q=[]}window.chatbase.q.push(arguments)};window.chatbase=new Proxy(window.chatbase,{get(target,prop){if(prop==="q"){return target.q}return(...args)=>target(prop,...args)}})}const onLoad=function(){const script=document.createElement("script");script.src="https://www.chatbase.co/embed.min.js";script.id="7pFdedNB2Kz1zUtlvlJte";script.domain="www.chatbase.co";document.body.appendChild(script)};if(document.readyState==="complete"){onLoad()}else{window.addEventListener("load",onLoad)}})();
    </script>
</body>
</html>